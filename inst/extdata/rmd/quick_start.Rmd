---
title: "QuickStart"
author: "Markus List and Konstantinos Mechteridis"
output: html_document
---



## QuickStart KeyPathwayMiner R-package {.tabset}
This is an R Markdwon document on how to get started with the KeyPathwayMiner R-package.
We will go through how to execute local and remote calls of KeyPathwayMiner and how to
change and view the run parameters.
For more details on using the KeyPathwayMiner please visit our website: <https://exbio.wzw.tum.de/keypathwayminer/>.

### Prepare data
```{r prepare_data}
# library("rJava")
# library("rjson")
# library("RCurl")
# library("roxygen2")
# library("settings")
# library("testthat")
# library("devtools")
# library("renv")
# library("formatR")  # formatR::tidy_dir('R')
# library("lintr")  # lintr::lint_package()
# library(foreach)

source(system.file("inst/extdata/api_testing/", "matrix-hd-up.dat", package = "Rkpm"))
# KeyPathWayMiner URL
url <- "https://exbio.wzw.tum.de/keypathwayminer/"

# Load indicator matrices as data.frame
huntington_disease_up <- as.data.frame.matrix(read.delim("matrix-hd-up.dat", header = FALSE))

huntington_disease_down <- as.data.frame.matrix(read.delim("matrix-hd-down.dat", header = FALSE))

huntington_list <- list(huntington_disease_up, huntington_disease_down)

graph_file = system.file("extdata", "sampleNetwork.sif", package="Rkpm")

# Get overview of available networks
print(get_networks(url))

# Get ID of I2D Homo_sapiens entrez network
I2D.id <- get_networks(url)[["I2D Homo_sapiens entrez"]]

```
### Remote runs
### Local runs

```{r}
huntington_disease_up <- as.data.frame.matrix(read.delim("matrix-hd-up.dat", header = FALSE))

huntington_disease_down <- as.data.frame.matrix(read.delim("matrix-hd-down.dat", header = FALSE))

huntington_list <- list(huntington_disease_up, huntington_disease_down)

graph_file = system.file("extdata", "sampleNetwork.sif", package="Rkpm")
#java -jar KPM-5.0.jar -strategy=GLONE -algo=GREEDY -L1=5 -matrix1=resources/datasets/colon-gene-expression-DOWN-p0.05.txt -L2=6 -matrix2=resources/datasets/colon-gene-expression-UP-p0.05.txt
# Combine multiple datasets:
kpm_options(execution = "Local", strategy = "GLONE", algorithm ="Greedy",l_min=c(5,2))
# Use ranged values with batch
kpm_options(execution = "Local", strategy = "INES", algorithm ="Greedy",l_min=c(1,1),l_step=c(2,2),l_max=c(3,3),
            k_min = 1,
            k_step = 2,
            k_max = 3,
            use_range_k = TRUE,
            use_range_l = TRUE)

settings::reset(kpm_options())
# Use perturbation
kpm_options(execution = "Local", strategy = "INES", algorithm ="Greedy",l_min=5,
            k_min = 2, perturbation_technique ="nodeswap",
            with_perturbation = TRUE,
            perturbation_start = 10,
            perturbation_step = 10,
            perturbation_max = 20,
            graphs_per_step = 1
            )

kpm(graph_file = graph_file, indicator_matrices  = huntington_disease_up)


```

## Usage example

You can also embed plots, for example:

```{r pressure, echo=FALSE}
# # # ### Example calls to demonstrate the usage of the KeyPathwayMinerWeb RESTful API ### Authors: Markus List and Martin Dissing-Hansen
# # # ### ###
# # #
# # # # Load test data and R functions to access KeyPathwayMiner Web source('restful_utils')
# # #
# # # KeyPathWayMiner URL
# # url <- "https://exbio.wzw.tum.de/keypathwayminer/"
# #
# #
#
# huntington_disease_up <- as.data.frame.matrix(read.delim("/Users/konstantinos/Workspace/keypathwayminer/Rkpm/inst/extdata/api_testing/matrix-hd-up.dat",
#     header = FALSE))
# huntington_disease_down <- as.data.frame.matrix(read.delim("/Users/konstantinos/Workspace/keypathwayminer/Rkpm/inst/extdata/api_testing/matrix-hd-down.dat",
#     header = FALSE))
#
# huntington_list <- list(huntington_disease_up, huntington_disease_down)
#
# # # Generate a unique identifier for this session
# # attached_to_id <- paste(sample(c(LETTERS[1:6], 0:9), 32, replace = TRUE), collapse = "")
# #
# # # List available networks
# # availableNetworks <- get_networks(url)
# # print(availableNetworks)
# #
# # # Use the I2D network
# # I2D.id <- get_networks(url)[["I2D Homo_sapiens entrez"]]
# #
# # # kpm_options(async = FALSE, l_min = 8, k_min = 1,
# # #             strategy = 'INES', remove_bens = TRUE,
# # #             graph_id = I2D.id, use_range = FALSE,
# # #             link_type = 'OR')
# # #
# # # kpm(list(huntington_disease_up))
# #
# # # # Start with a simple run on one dataset with fixed parameters for K and L using INES in a blocking call.
# # # # result.fixed.parameters.one.dataset <- call.KPM(list(huntington_disease_up), attached_to_id, async=FALSE, Lmin=8, Kmin=1,
# # # # strategy='INES', removeBENs=TRUE, graphID=I2D.id, graph.file=NULL, range=FALSE, linkType='OR')
# # #
# # # # results print(paste('browse to', result.fixed.parameters.one.dataset$resultUrl, 'to see the results'))
# # #
# # # # Start a ranged run on one dataset with fixed parameters for K and L using INES in a blocking call.
# # # # result.ranged.parameters.one.dataset <- call.KPM(list(huntington_disease_up), attached_to_id, async=FALSE, Lmin=4, Lmax=8,
# # # # Lstep=4, Kmin=0, Kmax=1, Kstep=1, strategy='INES', removeBENs=TRUE, graphID=I2D.id, graph.file=NULL, range=TRUE, linkType='OR')
# # #
# # # # results print(paste('browse to', result.ranged.parameters.one.dataset$resultUrl, 'to see the results'))
# # #
# # #
# # # # Start a run with INES and K = 1 where we use a percentage of L = 10% for the two datasets.  Note: The web service does not allow
# # # # individual fixed parameters to be set for each dataset at the moment. result.fixed.percentage.two.datasets <-
# # # # call.KPM(huntington_list, attached_to_id, async=TRUE, l_same_percentage = TRUE, strategy='INES', removeBENs=TRUE,
# # # # same_percentage=10, Kmin=1, graphID=I2D.id, graph.file=NULL, range=FALSE, linkType='OR')
# # #
# # # # Now we want to monitor progress in the client or in the browser:
# # #
# # # # extract job id (called quest id) quest.id <- result.fixed.percentage.two.datasets$questID
# # #
# # # # open the result page where you can monitor the progress of both tasks print(quest.progress.url(url, attached_to_id))
# # #
# # # # check status of the second job getStatus(url, quest.id)
# # #
# # # # if complete, download results of the second job if(status$completed){ result.fixed.percentage.two.datasets <- getResults(url,
# # # # quest.id) }
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
